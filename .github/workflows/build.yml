---
name: Build STL files
on:
  - pull_request
  - push
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          submodules: true

      - name: Install dependencies
        run: |
          sudo add-apt-repository ppa:openscad/releases
          sudo apt-get update
          sudo apt-get install openscad freebsd-buildutils

      - name: Build STL files
        run: |
          MATRIX_X="1 2 3"
          MATRIX_Y="1 2 3"
          for X in ${MATRIX_X}; do
            for Y in ${MATRIX_Y}; do
              fmake XY_FLAGS="-D num_x=${X} -D num_y=${Y}"
              mv drawer.stl ${X}x${Y}_drawer.stl
              mv house.stl ${X}x${Y}_house.stl
            done
          done
          ls *.stl
